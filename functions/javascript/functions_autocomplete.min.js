function iLance_AutoComplete(c,h){var b=this;this.clearField=false;this.minLength=2;this.elem=fetch_js_object(c);this.highlighted=-1;this.arrItens=new Array();this.ajaxTarget=AJAXURL+"?do=autocomplete&s="+ILSESSION+"&token="+ILTOKEN;this.chooseFunc=null;this.div=fetch_js_object(h);this.hideSelects=false;var a=9;var f=27;var e=38;var g=40;var d=13;b.elem.setAttribute("autocomplete","off");this.ajaxReq=createRequest();b.elem.onkeydown=function(k){var j=b.getKeyCode(k);switch(j){case a:case d:if(b.highlighted.id!="undefined"){b.acChoose(b.highlighted.id)}b.hideDiv();return false;break;case f:b.hideDiv();return false;break;case e:b.changeHighlight("up");return false;break;case g:b.changeHighlight("down");return false;break}};b.elem.onkeyup=function(k){var j=b.getKeyCode(k);switch(j){case a:case f:case e:case g:return;case d:return false;break;default:b.ajaxReq.abort();if(b.elem.value.length>=b.minLength){if(b.ajaxReq!=undefined){b.ajaxReq.open("POST",b.ajaxTarget,true);b.ajaxReq.setRequestHeader("Content-Type","application/x-www-form-urlencoded");b.ajaxReq.onreadystatechange=b.acResult;var l="q="+b.elem.value;b.ajaxReq.send(l)}}else{return}b.highlighted=""}};b.elem.onblur=function(){b.hideDiv()};this.setElemValue=function(){var j=b.highlighted.firstChild;b.elem.value=j.innerTEXT};this.highlightThis=function(j,k){if(k=="y"){b.highlighted.className="";b.highlighted=j;b.highlighted.className="selected";b.setElemValue(j)}else{j.className="";b.highlighted=""}};this.changeHighlight=function(j){if(b.highlighted!=""&&b.highlighted!=null){b.highlighted.className="";switch(j){case"up":if(b.highlighted.parentNode.firstChild==b.highlighted){b.highlighted=b.highlighted.parentNode.lastChild}else{b.highlighted=b.highlighted.previousSibling}break;case"down":if(b.highlighted.parentNode.lastChild==b.highlighted){b.highlighted=b.highlighted.parentNode.firstChild}else{b.highlighted=b.highlighted.nextSibling}break}b.highlighted.className="selected";b.setElemValue()}else{switch(j){case"up":b.highlighted=b.div.firstChild.lastChild;break;case"down":b.highlighted=b.div.firstChild.firstChild;break}b.highlighted.className="selected";b.setElemValue()}};this.acResult=function(){if(b.ajaxReq.readyState==4){b.showDiv();var l=b.ajaxReq.responseXML;if(l==undefined){return false}var n=l.getElementsByTagName("item");var o=n.length;b.div.innerHTML="";var m=document.createElement("div");b.div.appendChild(m);if(o>0){for(i=0;i<o;i++){b.arrItens[n[i].getAttribute("id")]=new Array();b.arrItens[n[i].getAttribute("id")]["label"]=n[i].getAttribute("label");b.arrItens[n[i].getAttribute("id")]["text"]=n[i].getAttribute("text");b.arrItens[n[i].getAttribute("id")]["searchmode"]=n[i].getAttribute("searchmode");b.arrItens[n[i].getAttribute("id")]["flabel"]=n[i].getAttribute("flabel");var j=document.createElement("div");j.id=n[i].getAttribute("id");j.onmouseover=function(){this.className="selected";b.highlightThis(this,"y")};j.onmouseout=function(){this.className="";b.highlightThis(this,"n")};j.onmousedown=function(){b.acChoose(this.id);b.hideDiv();return false};var k=document.createElement("a");k.href="#";k.onclick=function(){return false};k.innerHTML=unescape(n[i].getAttribute("label"));if(n[i].getAttribute("text")!=null){k.innerTEXT=unescape(n[i].getAttribute("text"))}else{k.innerTEXT=unescape(n[i].getAttribute("label"))}j.appendChild(k);m.appendChild(j)}}else{b.hideDiv()}}};this.acChoose=function(j){b.hideDiv();if(this.clearField){b.elem.value=""}else{b.elem.value=unescape(b.arrItens[j]["text"]);fetch_js_object("searchmode").value=unescape(b.arrItens[j]["searchmode"]);fetch_js_object("globalsearch").submit()}};this.positionDiv=function(){var k=this.elem;var j=0;var l=k.offsetHeight;while(k.offsetParent&&k.tagName.toUpperCase()!="BODY"){j+=k.offsetLeft;l+=k.offsetTop;k=k.offsetParent}j+=k.offsetLeft;l+=k.offsetTop;if(!checkmac){this.div.style.left=(j+6)+"px"}else{this.div.style.left=j+"px"}this.div.style.top=l+"px"};this.hideDiv=function(){b.highlighted="";b.div.style.display="none";b.handleSelects("")};this.showDiv=function(){b.highlighted="";b.positionDiv();b.handleSelects("none");b.div.style.display="block"};this.handleSelects=function(l){if(!b.hideSelects){return false}var k=document.getElementsByTagName("SELECT");for(var j=0;j<k.length;j++){k[j].style.display=l}};this.getKeyCode=function(j){if(j){return j.keyCode}if(window.event){return window.event.keyCode}};this.getEventSource=function(j){if(j){return j.target}if(window.event){return window.event.srcElement}};this.cancelEvent=function(j){if(j){j.preventDefault();j.stopPropagation()}if(window.event){window.event.returnValue=false}}}function createRequest(){try{var c;c=new XMLHttpRequest()}catch(b){try{c=new ActiveXObject("Msxml2.XMLHTTP")}catch(d){try{c=new ActiveXObject("Microsoft.XMLHTTP")}catch(a){c=false}}}if(!c){}else{return c}}var iL_AutoComplete;iL_AutoComplete=new iLance_AutoComplete("search_keywords_id","search_autocomplete");